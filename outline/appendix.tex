\section{Proofs of section 4}
Consider the following very standard non-idempotent type system for lambda calculus: 
\begin{proposition}\label{prop:affine}
	For all first-order terms $x_1:\1,\dots, x_n:\1\vdash_{\PLY}t:\1$, 
	$\model{t}^{\Rinf}(x_1,\dots, x_n)\in \fps{\Rinf}{x_1,\dots,x_n}$ is affine: there exists scalars $w_0,w_1,\dots, w_n\in\mathbb R_{\geq 0}$ such that
	\[
	\model{t}^{\Rsemiring}(x_1,\dots, x_n)
	=w_0+w_1x_1+\dots+w_nx_n,
	\]
	where $w_0=\mathbb P[t\to^* e]$ and
	$w_{i+1}=\mathbb P[t\to^* x_{i+1}]$.
\end{proposition}
\begin{proof}
	By the soundness of the PCOH model (Lemma 20 in (cite Pagani)):
 	$$\model{t}^{\Rinf} = \sum  $$
\end{proof}
\section{Proofs of section 6}
\subsection{Proof of theorem 6.2}
 We now define in a precise way the notion of linearization of a $\Gfin$. We remind that, following the terminology of (cite Ong), by 'linear' here we mean what in a strict sense would be 'affine'.  First we define the linearisation of a type:
\begin{align*}
	&\Aff(\1^n) =\1 \quad n \geq 1\\
	&\Aff({!_0 \phi \multimap \psi}) = \Aff(\phi) \multimap \Aff(\psi) \\  
	&\Aff({!_k \phi \multimap \psi}) = \underbrace{\Aff(\phi) \multimap \dots \multimap \Aff(\phi)}_{k \textit{ times}} \multimap \Aff(\psi)
\end{align*}
We need now define the linearisation of a the type derivation of an applicative term. In particular, to each derivation $\pi = \nonterm \mid \Delta \vdash \phi$ in $\Gfin$ we will associate a linear derivation $\Aff(\pi)$ of the form $\nonterm' \mid \Aff(\Delta) \vdash \phi$, where  $\nonterm'$ is obtained by $\nonterm $ by replacinf evry type binding $L:\varphi $ with $\AFF L: \Aff(\varphi)$ and $\Aff(\Delta)$ is obtained by $\Delta$ by replacing every type binding $x:_k \psi, \: k \geq 2$ with $k$ distinct bindings $x^{(1)}:\Aff(\psi) \dots x^{(k)}:\Aff(psi)$
\begin{itemize}
	\item For $\pi = \infer[ax1]{\nonterm\mid \Delta\vdash x:\varphi }{x:_p\varphi\in \Delta,\quad 1 \leq p}$, $\Aff(\pi) \bydef \pi$ 
	\item For  $\pi = \infer[ax2]{\nonterm\mid\Delta \vdash L:\varphi }{ L:\varphi  \in \nonterm}$, $\Aff(\pi) \bydef \infer[ax2]{\nonterm' \mid\Delta \vdash \AFF L:\Aff(\varphi) }{ L:\varphi  \in \nonterm} $ 
	\item If we have that $pi$ ends with an application $\nonterm\mid \Delta + k\Delta' \vdash tu : \psi$ with premises $\nonterm\mid\Delta \vdash t :!_k\varphi \multimap \tau$ and $\nonterm\mid \Delta' \vdash u :\varphi$, and we get inductively linearisation $\nonterm'\mid \Aff(\Delta) \vdash \Aff(t): \Aff(\phi) \multimap \dots \Aff(\phi) \multimap \Aff(\psi))$ (where $\Aff(\phi)$ is repeated $k$ times)  and  $\nonterm' \mid \Aff(\Delta') \vdash u :\varphi$. Now we create $k$ different copies $u_1, \dots u_k$ of $u$ by replacing its free variables $x_1, \dots x_n$ with variables $x^{(i)}_1, \dots x^{(i)}_n, 1 \leq i \leq k$ and we create in the same way $k$ different copies of the derivation $\nonterm' \mid \Aff(\Delta') \vdash u :\varphi$. Now by $k$ linear applications we can type $t u_1 \dots u_k$ with type $\Aff(\phi)$; this is the linearisation of $tu$
	\item If we have $pi$ ends with an abstraction $\nonterm\mid \Delta \vdash \lambda x. t : !_k \varphi \multimap \psi$ with premises $\nonterm \mid \Delta, x:_k \varphi \vdash t : \psi$, then take its linearisation $\nonterm \mid \Aff(\Delta),x^{(1)}:\Aff(\varphi) \dots x^{(k)}:\Aff(\varphi) \vdash t : \Aff(\psi)$ and; by $k$ abstraction we then obtain a linear derivation of $\lambda x^{(1)} \dots x^{(k)}.t: \Aff(\phi) \multimap \dots \Aff(\phi) \multimap \Aff(\psi))$,  (where $\Aff(\phi)$ is repeated $k$ times).
	\item In the case of $\pi_i$ and $\langle \rangle$, we can just apply them to their linearised premises and obtain a linearised conclusion.
\end{itemize} 
Now given a $ \gphors=(\nonterm, \C R, S)$, we define its linearisation $\AFF\gphors=(\nonterm, \C R',\AFF S)$ by $\C R'(L) \bydef \Aff(\C R(L))$ for each non terminal $L$. In particular, $\AFF{S}$ will have equation $\AFF S= \Aff(\C \R(S))$ Call $\AFF{\redbigp{ }}$ the corresponding rewriting\\
To see that $\AFF \gphors$ generates the same tree as $\gphors$, we need the following lemmas:
\begin{lemma}
	Let $\nonterm \mid \Delta, x:_k  \vdash  t[x]$ be a term typable in $\Gfin$ and let $\nonterm' \mid \Aff(\Delta), x^{(1)}: \Aff(\varphi), \dots x^{(k)}: \Aff(\varphi) \vdash  \Aff t[x^{(1)}, \dots x^{(k)}]$ be its linearisation. Let $u$ be a term of type $\varphi$ and let $Aff(u)$ be its linearisation; then, up to a renaming of the free variables:
	$$\Aff(t[x/u]) = \Aff(t)[x^{(1)}/\Aff(u)_1, \dots x^{(k)}/\Aff(u)_k] $$ 
	where $\Aff(u)_1 \dots \Aff(u)_k$ are obtained from $\Aff(u)$ by replacing its free variables with fresh ones.
\end{lemma}
\begin{proof}
	By induction on the definition of linearisation.
\end{proof}
Then we have
\begin{lemma} For each non terminal $L$ and $d \in l,r$
	$L t_1 \dots t_n  \redbigp{\mathsf d,p} t_L[x_1/t_1, \dots x_n/t_n]$ iff $\Aff(L t_1 \dots t_n)  \redbigp{\mathsf d,p} \Aff(t_d[x_1/t_1, \dots x_n/t_n])$
\end{lemma}
\begin{proof}
	We have that $\Aff(Lt_1 \dots t_n)= \AFF L \Aff(t_1)^{n_1} \dots \Aff(t_k)^{n_k} \AFF{\redbigp{\mathsf d,p}} \Aff(t_d)[x_1^{n_1}/(t_1)^{n_1}, \dots x_1^{n_1}/(t_k)^{n_k}]$, but this by the previous lemma is equal (all terms being closed, no renaming of the free variables is needed) to $\Aff(t_d[x_1/t_1, \dots x_n/t_n])$
\end{proof}  
Finally, notice that $e$ is the only normal form both for $\gphors$ and $\AFF \gphors$ and that the linearisation of $e$ is $e$. From this we see that there exists a bisimulation between the rewriting system of $\gphors$ and the one of $\AFF \gphors$, hence they generate the same tree.
\subsection{Proof of proposition}
To prove proposition 6.3, we prove first the following correctness lemma:
\begin{lemma}[Correctness of $\Gfin$]
	Given $\nonterm\mid\Delta\vdash t:\varphi$, with $\varphi\tri T$, let $s_{\model{T}} \bydef \model{t: T}^{\Rsemiring} $ be its $\Qrelkleisli \Rsemiring$interperetation: We have that:
	\begin{enumerate}
		\item For each $\sigma \in \model{T} \setminus \model{\varphi}$, 
		\begin{equation}
			s_\sigma\big\vert_{\model{\nonterm}+ \model{\Delta}}=0
		\end{equation}
		\item For each $\sigma \in \model{\varphi}$, $s_\sigma\big\vert_{\model{\nonterm}+ \model{\Delta}} \in \fpp{\Rsemiring}{\model{\nonterm}+ \model{\Delta}}$. Moreover, for each $f:_k \psi \in \Delta$, the degree of $s_\sigma$ in the variables $x_{f:_k \psi}$ is at most $k$
	\end{enumerate}
\end{lemma}
	\begin{proof}
		By induction on the type derivation $\nonterm\mid\Delta\vdash t:\varphi$. We immidiately see this is true for the axioms. We discuss here the crucial cases: application and abstraction.\\ 
		Application: suppose we know that the thesis is true for $\nonterm\mid\Delta\vdash t:!_k \psi \multimap \varphi \tri T \to S$ and $\nonterm\mid\Delta'\vdash u: \psi \tri T$. We want to prove that it is true for $\nonterm\mid\Delta+ k\Delta'\vdash (tu): \varphi \tri T$ Let $s_{\model{S}} \bydef \model{tu: S}^\Rsemiring$ We know that by definition:
		$$s_\sigma\big\vert_{\model{\nonterm}+ \model{\Delta}+ \model{\Delta'}} = \left( \sum_{\mu \in !{\model{T}}} \model{t}^\Rsemiring_{\mu, \sigma} (\model{u}^\Rsemiring)^\mu \right) \Big\vert_{\model{\nonterm}+ \model{\Delta}+ \model{\Delta'}} $$

	When we restrict the RHS to variables from $\model{\nonterm}+ \model{\Delta}+ \model{\Delta'}$, noticing that $\model{t}^\Rsemiring$ does not depend on variables $x_{\Delta}$ and $\model{u}^\Rsemiring$ does not depend on variables $x_{\Delta'}$, we obtain:
	\begin{equation}
		\label{eq:sumrestrict}
	\sum_{\mu \in !{\model{T}}} \model{t}^\Rsemiring_{\mu, \sigma} \Big\vert_{\model{\nonterm}+ \model{\Delta}} (\model{u}^\Rsemiring)^\mu \Big\vert_{\model{\nonterm}+ \model{\Delta'}}
	\end{equation}
	If $\sigma \in \model{T} \setminus \model{\sigma}$, then for all $\mu \in \model{T}$, $(\mu, \sigma) \in \model{T \to S} \setminus \model{!_k \psi \multimap \varphi}$, hence $ \model{t}^\Rsemiring_{\mu, \sigma} \Big\vert_{\model{\nonterm}+ \model{\Delta}}=0$ and the sum is $0$\\
	Let $\sigma \in \model{!_k\psi \multimap \varphi}$. By inductive hypothesis, each term in the sum \ref{eq:sumrestrict} is a polynomial, hence the sum is a polynomial. Now, let $f:_k \xi \in \Delta + k\Delta'$; assume that $f:_n \xi \in \Delta$ and $f_m: \xi \in \Delta'$ and let $y$ be a variables in $x_{f:_k \xi}$. We have that the maximal degree of each $\model{t}^\Rsemiring_{\mu, \sigma} \Big\vert_{\model{\nonterm}+ \model{\Delta}}$ in $y$ is (by inductive hypothesis) at most $n$ and the degree of each   $(\model{u}^\Rsemiring)\Big\vert_{\model{\nonterm}+ \model{\Delta'}}$ in $y$ is at most $m$. Since for all $\mu$ such $|\mu|>k$ we have by thesis (1) that $\model{t}^\Rsemiring_{\mu, \sigma} \Big\vert_{\model{\nonterm}+ \model{\Delta}}=0$, the maximal degree of a nonero product $\Big\vert_{\model{\nonterm}+ \model{\Delta}} (\model{u}^\Rsemiring)^\mu \Big\vert_{\model{\nonterm}+ \model{\Delta'}}$ is $n+km$.\\
	Abstraction: we prove
\end{proof} 
\section{prova}
